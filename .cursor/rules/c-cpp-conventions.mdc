---
globs: *.c,*.cpp,*.h,*.hpp
---
# C/C++ Coding Conventions

## Header File Organization
- Always include `<staden_config.h>` (or `$(PWD)/staden_config.h`) when needed
- Use relative paths for project headers: `#include "error.h"` not `#include <error.h>`
- Include order: system headers, then project headers
- See [Misc/error.c](mdc:Misc/error.c) for example

## Common Headers
Most C files include:
- `#include "misc.h"` - Common definitions
- `#include "os.h"` - OS abstraction layer
- `#include "xalloc.h"` - Memory allocation wrappers
- `#include "xerror.h"` - Error handling

## Memory Management
- Use `xalloc.h` functions instead of standard `malloc/free`
- Functions like `xmalloc()`, `xrealloc()`, `xcalloc()` abort on failure
- Always check return values from allocation functions

## Error Handling
- Use `error.h` functions: `errout()`, `messout()`
- Use `xerror.h` for fatal errors
- Format strings use `__PRINTF_FORMAT__(1,2)` attribute when available
- See [Misc/error.c](mdc:Misc/error.c) for examples

## Coding Style
- Function names: lowercase with underscores (e.g., `errout`, `messout`)
- Use ANSI C function declarations (prototypes)
- Comment blocks use `/* */` style
- Functions should have usage comments above them

## Printf Format Security
- Use format attribute: `__PRINTF_FORMAT__(1,2)` for printf-like functions
- Example from [Misc/error.c](mdc:Misc/error.c):
```c
__PRINTF_FORMAT__(1,2)
void errout(char *fmt, ...) {
    va_list args;
    va_start(args, fmt);
    vfprintf(stderr, fmt, args);
    va_end(args);
}
```

## Portability
- Use `os.h` for OS-specific abstractions
- Use `Misc/` functions for portability (files, strings, etc.)
- Large file support via autoconf (`AC_SYS_LARGEFILE`)
- Endianness checked via `AC_C_BIGENDIAN`

## Shared Library Exports
- Windows: Use `.def` files for DLL exports
- Generated via `$(MKDEFL)` command in Makefiles
- See library Makefiles for `.def` file generation

## Compiler-Specific Features
- Use `AC_C_INLINE` for inline function support
- `va_copy` support checked via `AX_FUNC_VA_COPY`
- Compiler warnings: Code should compile without warnings

## C++ Code (mutlib/)
- C++ code in `mutlib/` uses standard C++ practices
- Headers use `.hpp` extension
- Source files use `.cpp` extension
- See `mutlib/` for examples

## Include Path Strategy
- `INCLUDES` in Makefiles includes:
  - `-I$(SRC)` - Current source directory
  - `-I$(BUILD)` - Build directory (for generated headers)
  - Component-specific includes (e.g., `-I$(GSRC)`, `-I$(GAP4SRC)`)

## Dependency Management
- Use `make depend` to generate dependencies
- Dependencies stored in Makefile after `# DO NOT DELETE THIS LINE`
- `makedepend` processes source files to generate deps

## Build Configuration
- `staden_config.h` contains platform-specific defines
- Generated by autoconf from `staden_config.h.in`
- Check this file for available feature macros
